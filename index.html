<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="http://elm-in-action.com/styles.css" />
    <link rel="stylesheet" href="http://elm-in-action.com/range-slider.css" />
    <script src="http://elm-in-action.com/range-slider.js"></script>
    <script src="slider.js"></script>
  </head>
  <body>
    <div id="app"></div>
    <script src="http://elm-in-action.com/pasta.js"></script>
    <script src="app.js"></script>
    <script>
      // init returns an object that lets us subscribe to data
      // Elm sends to JS via ports
      const app = Elm.PhotoGroove.init({
        node: document.getElementById('app'),
      });

      // When the Elm runtime executes the Cmd returned by setFilters,
      // the callback passed here wll run
      // The options arg is the FilterOptions record that Elm sent over,
      // but converted to a JS object
      app.ports.setFilters.subscribe((options) => {
        // requestAnimationFrame allows code to run just before the
        // browser's next repaint
        // Because this is when the Elm runtime will schedule its
        // next DOM update, we can use it to delay getting our canvas
        // element until our next call to `view` has added the canvas
        // we need to the DOM
        requestAnimationFrame(() => {
          Pasta.apply(document.getElementById('main-canvas'), options);
        });
      });

      // Pasta calls this function whenever its activity changes
      Pasta.addActivityListener((activity) =>
        console.log('Got some activity to send to Elm: ', activity)
      );
    </script>
  </body>
</html>
